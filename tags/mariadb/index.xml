<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>mariadb on KRAPSHSA'S BLOG</title><link>https://krapshsa.github.io/tags/mariadb/</link><description>Recent content in mariadb on KRAPSHSA'S BLOG</description><generator>Hugo -- gohugo.io</generator><language>zh-tw</language><copyright>© 2007 - 2022 krapshsa</copyright><lastBuildDate>Thu, 04 Aug 2022 18:46:00 +0800</lastBuildDate><atom:link href="https://krapshsa.github.io/tags/mariadb/index.xml" rel="self" type="application/rss+xml"/><item><title>記一次 MariaDB CPU Loading 滿載查修過程</title><link>https://krapshsa.github.io/posts/mariadb-cpu-loading-e49af856-cc1f-45bf-9e40-f97a0718d89f/</link><pubDate>Thu, 04 Aug 2022 18:46:00 +0800</pubDate><guid>https://krapshsa.github.io/posts/mariadb-cpu-loading-e49af856-cc1f-45bf-9e40-f97a0718d89f/</guid><description>起因 客戶環境的 MariaDB 把 CPU Resource 都吃滿了，
用 SHOW PROCESSLIST 查詢有看到好幾條慢的查詢，亂槍打鳥調整了前幾筆都不見改善。
為了要可以比較精準地改善問題，做了一些研 (goo) 究 (gle)。
症狀 用 TOP 只看得到 CPU 吃滿，但是記憶體的狀況是 OK 的
ATOP 看起來硬碟也不忙，由於服務跟 DB 建在同一台，應該也不是網路問題
約好停服務之後，不管三七二十一先 OPTIMIZE TABLE 也沒有用 卡住的前幾名都是 UPDATE，一度懷疑是寫入的問題，但是實際找一個測試資料 Insert / Update 都很快，把這個 UPDATE 相關的 Code 拔掉也沒有用。 修復流程 值得參考的流程 A Simple Approach to Troubleshooting High CPU in MySQL - Percona Database Performance Blog
參考了 Percona 給出的流程，寫得挺不錯的 👍
雖然我的 DB 版本太舊了沒有用 (必須要 MariaDB 10.5 以上才有 THREAD_OS_ID )。</description></item><item><title>OwnCloud MariaDB mysqldump 失敗</title><link>https://krapshsa.github.io/posts/owncloud-mariadb-mysqldump-84758a8c-6502-4c2d-b878-3a97ea0e36a7/</link><pubDate>Wed, 27 Jul 2022 14:58:00 +0800</pubDate><guid>https://krapshsa.github.io/posts/owncloud-mariadb-mysqldump-84758a8c-6502-4c2d-b878-3a97ea0e36a7/</guid><description>起因 近期遭遇 mysqldump 備份 OwnCloud 的 DB 結果 crash 的問題
google 了一下發現 NextCloud 也有人發生類似的問題
Table oc_filecache_extended corrupt?
摘錄連結內的錯誤訊息：
Thread pointer: 0x8548068d8 Attempting backtrace. You can use the following information to find out where mysqld died. If you see no messages after this, something went terribly wrong... stack_bottom = 0x7fffdf76cf38 thread_stack 0x3c000 0x12fcbfc &amp;lt;my_print_stacktrace+0x3c&amp;gt; at /usr/local/libexec/mariadbd 0xc6330f &amp;lt;handle_fatal_signal+0x28f&amp;gt; at /usr/local/libexec/mariadbd 0x8018f7de0 &amp;lt;pthread_sigmask+0x530&amp;gt; at /lib/libthr.so.3 Trying to get some variables. Some pointers may be invalid and cause the dump to abort.</description></item></channel></rss>