<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>docker on KRAPSHSA'S BLOG</title><link>https://krapshsa.github.io/tags/docker/</link><description>Recent content in docker on KRAPSHSA'S BLOG</description><generator>Hugo -- gohugo.io</generator><language>zh-tw</language><copyright>© 2007 - 2022 krapshsa</copyright><lastBuildDate>Thu, 28 Jul 2022 08:19:00 +0000</lastBuildDate><atom:link href="https://krapshsa.github.io/tags/docker/index.xml" rel="self" type="application/rss+xml"/><item><title>使用 container 在同一個 stack 部屬 log driver 時，docker stack rm 經常性失敗</title><link>https://krapshsa.github.io/posts/container-stack-log-driver-docker-stack-rm/</link><pubDate>Thu, 28 Jul 2022 08:19:00 +0000</pubDate><guid>https://krapshsa.github.io/posts/container-stack-log-driver-docker-stack-rm/</guid><description>使用 container 在同一個 stack 部屬 log driver 時，docker stack rm 經常性失敗 起因 最近把 fluentd 加入到 docker swarm 中當作 Log Driver 的時候，
移除 docker stack 時，關閉得比較慢的 service 有機會沒辦法完整移除。
此時 docker inspect ， docker rm 等指令都會卡住。
唯一的解法就是重啟 docker daemon。
猜測因為沒辦法保證 fluentd 在最後一個關閉導致出錯了。
重製步驟 移除 docker stack
docker stack rm mystack 檢查 service 都移除掉了
docker service ls ID NAME MODE REPLICAS IMAGE PORTS
發現還有 container 沒有正常關閉，且永遠卡在這個狀態
docker stack ps mystack --no-trunc ID NAME IMAGE NODE DESIRED STATE CURRENT STATE ERROR PORTS</description></item><item><title>docker swarm 環境設定 firewalld</title><link>https://krapshsa.github.io/posts/docker-swarm-firewalld/</link><pubDate>Wed, 22 Jun 2022 08:47:00 +0000</pubDate><guid>https://krapshsa.github.io/posts/docker-swarm-firewalld/</guid><description>docker swarm 環境設定 firewalld 起因 事前準備 sudo iptables -t filter -F sudo iptables -t filter -X sudo iptables -t nat -F sudo iptables -t nat -X sudo systemctl restart docker 單台 sudo firewall-cmd --permanent --direct --remove-chain ipv4 filter DOCKER-USER sudo firewall-cmd --permanent --direct --remove-rules ipv4 filter DOCKER-USER sudo firewall-cmd --permanent --direct --add-chain ipv4 filter DOCKER-USER sudo firewall-cmd --permanent --direct --add-rule ipv4 filter DOCKER-USER 0 -p tcp -m multiport --dports 3306,24224 -s 127.</description></item></channel></rss>