<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on KRAPSHSA'S BLOG</title><link>https://krapshsa.github.io/posts/</link><description>Recent content in Posts on KRAPSHSA'S BLOG</description><generator>Hugo -- gohugo.io</generator><language>zh-tw</language><copyright>© 2007 - 2022 krapshsa</copyright><lastBuildDate>Sat, 20 Aug 2022 14:27:00 +0800</lastBuildDate><atom:link href="https://krapshsa.github.io/posts/index.xml" rel="self" type="application/rss+xml"/><item><title>Grind 75 Week 1 回顧</title><link>https://krapshsa.github.io/posts/grind-75-week-1-25ae9972-3073-40bc-a1b3-0ddf7ae7fb41/</link><pubDate>Sat, 20 Aug 2022 14:27:00 +0800</pubDate><guid>https://krapshsa.github.io/posts/grind-75-week-1-25ae9972-3073-40bc-a1b3-0ddf7ae7fb41/</guid><description>小心得 Week 1 的題目都是 Easy，(除了 53. Maximum Subarray 現在難度被重新評級為 Medium)
雖然不至於寫不出來，但是還是有很容易寫錯的題目。
發現我對於臨界值的掌握有點差：
經常發生越界 不知道可以剪枝 (有時候會遞迴重複項目) Two Sum 暴力法，用兩個 Loop 嘗試各種組合
Valid Parentheses Stack，成對的就 pop 掉，不然就塞進 Stack 內
Merge Two Sorted Lists 相同大小無順序，就把兩個 List 都輪流遍歷就可以了
終止條件是 List 都為空就做完了
Best Time to Buy and Sell Stock 買點是各個可能的谷底，在從左到右的過程中，如果遇到更低的價格，就更新潛在最佳買點。
但是這題沒有要求是哪個點，所以就計算最大利潤存起來就好。
Valid Palindrome 題目寫：
Alphanumeric characters include letters and numbers.
我漏掉了數字，WA 一次，這題我花比較多時間，因為第一次寫 Go 不知道到底要怎麼判斷字符。
Invert Binary Tree 遞迴交換，新的右邊是舊的左邊 invertTree，左邊也是同樣道理。
Valid Anagram 用 hasmap 存出現頻率</description></item><item><title>iOS 瀏覽器無法瀏覽高 DPI 的 pdf</title><link>https://krapshsa.github.io/posts/ios-dpi-pdf-16af8336-45e8-4ad0-8764-5a0eab1ec309/</link><pubDate>Mon, 15 Aug 2022 19:26:00 +0800</pubDate><guid>https://krapshsa.github.io/posts/ios-dpi-pdf-16af8336-45e8-4ad0-8764-5a0eab1ec309/</guid><description>起因 NextCloud 有一個功能 (PDF Viewer)，
可以讓我在手機瀏覽器上直接瀏覽 PDF。
但是今天有一個用掃描器掃上來的 PDF 卻無法正常在手機端瀏覽
症狀 瀏覽 pdf 的時候會一片空白，並且產生錯誤訊息
Canvas area exceeds the maximum limit (width * height &amp;gt; 16777216). 經查詢原來是 iOS 的 canvas element 有大小限制：
Canvas Area Exceeds The Maximum Limit
跟 PDF.js 無關，所以這條 issue 至今也是無解：
解決方法 搬運 askubuntu 的解法，先在 Server Side 用 ghost script 把 DPI 改小就好了：
gs -sDEVICE=pdfwrite \ -dCompatibilityLevel=1.4 \ -dPDFSETTINGS=/ebook \ -dNOPAUSE \ -dQUIET \ -dBATCH \ -sOutputFile=output.pdf input.pdf -dCompatibilityLevel (不知道有什麼用)</description></item><item><title>簡易 C Mock — wrapper function</title><link>https://krapshsa.github.io/posts/c-mock-wrapper-function-87728a4c-9871-48d0-9b84-24dc3483bce4/</link><pubDate>Sat, 06 Aug 2022 11:12:00 +0800</pubDate><guid>https://krapshsa.github.io/posts/c-mock-wrapper-function-87728a4c-9871-48d0-9b84-24dc3483bce4/</guid><description>起因 幫一個舊的 Lib 寫測試的時候會去讀 config，
但是這個路徑在我的 CI 環境並不存在，
通常我寫 php 的時候，針對這種外部相依就用 function 包起來再 Mock 掉，
但是 C 我已經忘得差不多了，想找一個簡單可以做到類似效果的方法。
目前解法 不囉唆，先上 code
GitHub - krapshsa/c-native-mock
這個簡單的 Case 是這樣：
main() 呼叫 foo() ， foo() 呼叫 config_load()
我想要不改變 foo.c ，讓測試 (main.c ) 可以不去真的用到 config_load() 其實這就相當於寫測試：
main() 是 Test，而 foo.c 的 foo() 是我的 SUT (System Under Test)。
手法就是 Wrap，根據 ld 的 Man Page：
--wrap=symbol
Use a wrapper function for symbol. Any undefined reference to symbol will be resolved to &amp;ldquo;__wrap_symbol&amp;rdquo;.</description></item><item><title>C Unit Test - Criterion 簡單範例</title><link>https://krapshsa.github.io/posts/c-unit-test-criterion-eb7169c5-0a5e-4e8d-b9b5-04a8aa841ba1/</link><pubDate>Fri, 05 Aug 2022 01:52:00 +0800</pubDate><guid>https://krapshsa.github.io/posts/c-unit-test-criterion-eb7169c5-0a5e-4e8d-b9b5-04a8aa841ba1/</guid><description>起因 要用一個公司很久以前自己寫的 C Lib，沒有文件所以不知道行為是什麼。
使用的過程中有發現問題，就進行一些修正。
想說幫他加上一些測試案例，幫助之後要使用的人。
環境 建置方法 由於公司是用 CentOS / RHEL / Oracle，我挑了一個差不多的 image 來建 CI
重點是 rpm 我從 github 上面裝，就可以直接 -l 使用他的 Lib
其他是這個 C lib 需要的其他 Lib，跟底下範例無關
Dockerfile
FROM oraclelinux:8.6 RUN yum install -y gcc make pcre pcre-devel RUN yum --enablerepo=ol8_codeready_builder install -y glibc glibc-common glibc-devel glibc-headers glibc-static RUN rpm -ivh https://github.com/samber/criterion-rpm-package/releases/download/2.3.3/libcriterion-devel-2.3.3-2.el7.x86_64.rpm Code sut.h
#ifndef TEST_CRITERION_SUT_H #define TEST_CRITERION_SUT_H typedef struct result { char *begin; } Result; extern int doSomething(char *pContent, Result **ppResult); extern void sutFree(Result **ppResult); #endif //TEST_CRITERION_SUT_H sut.</description></item><item><title>記一次 MariaDB CPU Loading 滿載查修過程</title><link>https://krapshsa.github.io/posts/mariadb-cpu-loading-e49af856-cc1f-45bf-9e40-f97a0718d89f/</link><pubDate>Thu, 04 Aug 2022 18:46:00 +0800</pubDate><guid>https://krapshsa.github.io/posts/mariadb-cpu-loading-e49af856-cc1f-45bf-9e40-f97a0718d89f/</guid><description>起因 客戶環境的 MariaDB 把 CPU Resource 都吃滿了，
用 SHOW PROCESSLIST 查詢有看到好幾條慢的查詢，亂槍打鳥調整了前幾筆都不見改善。
為了要可以比較精準地改善問題，做了一些研 (goo) 究 (gle)。
症狀 用 TOP 只看得到 CPU 吃滿，但是記憶體的狀況是 OK 的
ATOP 看起來硬碟也不忙，由於服務跟 DB 建在同一台，應該也不是網路問題
約好停服務之後，不管三七二十一先 OPTIMIZE TABLE 也沒有用 卡住的前幾名都是 UPDATE，一度懷疑是寫入的問題，但是實際找一個測試資料 Insert / Update 都很快，把這個 UPDATE 相關的 Code 拔掉也沒有用。 修復流程 值得參考的流程 A Simple Approach to Troubleshooting High CPU in MySQL - Percona Database Performance Blog
參考了 Percona 給出的流程，寫得挺不錯的 👍
雖然我的 DB 版本太舊了沒有用 (必須要 MariaDB 10.5 以上才有 THREAD_OS_ID )。</description></item><item><title>Windows 上的類 Unix 環境 - Cygwin、MinGW、MSYS</title><link>https://krapshsa.github.io/posts/windows-unix-cygwin-mingw-msys-05707f1a-cacd-4484-9457-7aa26c7cace8/</link><pubDate>Sun, 31 Jul 2022 22:58:00 +0800</pubDate><guid>https://krapshsa.github.io/posts/windows-unix-cygwin-mingw-msys-05707f1a-cacd-4484-9457-7aa26c7cace8/</guid><description>起因 裝了 CLion，想在 Windows 底下為了在 Windows 上使用 gcc ，沒有想到竟然如此困難。
JetBrains IDE 會自動偵測有沒有 Git ，在 Windows 上如果沒有先裝好的話，他就會安裝 Git for Windows。
Git for Windows 自帶了一個很像 Linux 的環境，但是卻很難用它開始進行 C 的開發。
古早味做法 Dev-C++ - 维基百科，自由的百科全书
Code::Blocks
Code::Blocks 跟 Dev-C++ 是 Windows 上的 C/C++ IDE，
剛入門的時候都是用這兩套，裝好就會順便幫你裝 MinGW。
反正會動，可以交作業就好，所以當時也沒有很在意到底不同的方案差在哪裡，只知道可能有些東西會編不過。
Best way to get around fork() with MingW 64?
從 Wiki 上我們可以大概知道這是什麼東西：
MinGW（Minimalist GNU for Windows），又稱mingw32，是將 GCC 編譯器和 GNU Binutils 移植到Win32平台下的產物，包括一系列標頭檔（Win32API）、函式庫和可執行檔。
2005年, OneVision Software遵照淨室設計原則，開始開發Mingw-w64，因為最初的MinGW項目更新太慢，遲遲不支持64位環境開發
其他科系的程式設計課用的都是 Visual Studio，用的編譯器是 Visual C++，我沒用過不清楚，</description></item><item><title>docker stack rm 在有 fluentd 的時候總有服務關不掉</title><link>https://krapshsa.github.io/posts/docker-stack-rm-fluentd-3c0047b9-a458-4700-a6f2-b41dcd7da96d/</link><pubDate>Thu, 28 Jul 2022 16:19:00 +0800</pubDate><guid>https://krapshsa.github.io/posts/docker-stack-rm-fluentd-3c0047b9-a458-4700-a6f2-b41dcd7da96d/</guid><description>最近把 fluentd 加入到 docker swarm 中當作 Log Driver 的時候，
移除 docker stack 時，關閉得比較慢的 service 有機會沒辦法完整移除。
此時 docker inspect ， docker rm 等指令都會卡住。
唯一的解法就是重啟 docker daemon。
猜測因為沒辦法保證 fluentd 在最後一個關閉導致出錯了。
移除 docker stack docker stack rm mystack 檢查 service 都移除掉了 docker service ls ID NAME MODE REPLICAS IMAGE PORTS 發現還有 container 沒有正常關閉，且永遠卡在這個狀態 docker stack ps mystack --no-trunc ID NAME IMAGE NODE DESIRED STATE CURRENT STATE ERROR PORTS 5fllkwthpur60gzgeqq4cow48 i1i65yn2b35jqsfqk7gb9y7l8.1 my-clamav:2022-0406-145048 localhost.localdomain Remove Running about a minute ago 檢查系統的 Log，有出現如下訊息 (我是 CentOS)：</description></item><item><title>使用 container 在同一個 stack 部屬 log driver 時，docker stack rm 經常性失敗</title><link>https://krapshsa.github.io/posts/container-stack-log-driver-docker-stack-rm-3c0047b9-a458-4700-a6f2-b41dcd7da96d/</link><pubDate>Thu, 28 Jul 2022 16:19:00 +0800</pubDate><guid>https://krapshsa.github.io/posts/container-stack-log-driver-docker-stack-rm-3c0047b9-a458-4700-a6f2-b41dcd7da96d/</guid><description>起因 最近把 fluentd 加入到 docker swarm 中當作 Log Driver 的時候，
移除 docker stack 時，關閉得比較慢的 service 有機會沒辦法完整移除。
此時 docker inspect ， docker rm 等指令都會卡住。
唯一的解法就是重啟 docker daemon。
猜測因為沒辦法保證 fluentd 在最後一個關閉導致出錯了。
重製步驟 移除 docker stack docker stack rm mystack 檢查 service 都移除掉了 docker service ls ID NAME MODE REPLICAS IMAGE PORTS 發現還有 container 沒有正常關閉，且永遠卡在這個狀態 docker stack ps mystack --no-trunc ID NAME IMAGE NODE DESIRED STATE CURRENT STATE ERROR PORTS 5fllkwthpur60gzgeqq4cow48 i1i65yn2b35jqsfqk7gb9y7l8.1 my-clamav:2022-0406-145048 localhost.</description></item><item><title>OwnCloud MariaDB mysqldump 失敗</title><link>https://krapshsa.github.io/posts/owncloud-mariadb-mysqldump-84758a8c-6502-4c2d-b878-3a97ea0e36a7/</link><pubDate>Wed, 27 Jul 2022 14:58:00 +0800</pubDate><guid>https://krapshsa.github.io/posts/owncloud-mariadb-mysqldump-84758a8c-6502-4c2d-b878-3a97ea0e36a7/</guid><description>起因 近期遭遇 mysqldump 備份 OwnCloud 的 DB 結果 crash 的問題
google 了一下發現 NextCloud 也有人發生類似的問題
Table oc_filecache_extended corrupt?
摘錄連結內的錯誤訊息：
Thread pointer: 0x8548068d8 Attempting backtrace. You can use the following information to find out where mysqld died. If you see no messages after this, something went terribly wrong... stack_bottom = 0x7fffdf76cf38 thread_stack 0x3c000 0x12fcbfc &amp;lt;my_print_stacktrace+0x3c&amp;gt; at /usr/local/libexec/mariadbd 0xc6330f &amp;lt;handle_fatal_signal+0x28f&amp;gt; at /usr/local/libexec/mariadbd 0x8018f7de0 &amp;lt;pthread_sigmask+0x530&amp;gt; at /lib/libthr.so.3 Trying to get some variables. Some pointers may be invalid and cause the dump to abort.</description></item><item><title>在 template literal 中使用函數</title><link>https://krapshsa.github.io/posts/template-literal-bea4efe5-2565-42f7-832f-580089f7807d/</link><pubDate>Tue, 21 Jun 2022 16:18:00 +0800</pubDate><guid>https://krapshsa.github.io/posts/template-literal-bea4efe5-2565-42f7-832f-580089f7807d/</guid><description>起因 在 Code Review 的時候，同事原本是使用多次字串相接
const object1 = { a: &amp;#39;somestring&amp;#39;, b: 42 }; let html = `&amp;lt;ul&amp;gt;`; for (const [key, value] of Object.entries(object1)) { html += `&amp;lt;li&amp;gt;${key}: ${value}&amp;lt;/li&amp;gt;`; } html += `&amp;lt;/ul&amp;gt;`; 後來想要表達出 html 的階層結構，想用使用巢狀的方式使用 template literal
解方 要用 function 來做的話可以使用 IIFE
const object1 = { a: &amp;#39;somestring&amp;#39;, b: 42 }; let html = ` &amp;lt;ul&amp;gt; ${ (function(){ let list = &amp;#39;&amp;#39;; for (const [key, value] of Object.entries(object1)) { list += `&amp;lt;li&amp;gt;${key}: ${value}&amp;lt;/li&amp;gt;`; } return list; })() } &amp;lt;/ul&amp;gt; `; 以我簡化的例子來說，使用 IIFE 看起來變得更複雜了，</description></item></channel></rss>